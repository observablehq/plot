<script setup>

import * as Plot from "@observablehq/plot";
import * as d3 from "d3";

</script>

# Pointer transform

When a chart gives an overview of a dataset, we sometimes want to focus on a certain region of interest, for instance to obtain details about specific data points—such as outliers in a scatterplot.

**TODO** Most standard marks support the **tip** option, which enables a default interaction that displays, on demand, the channel values pertaining to the mark that the user points to.

example 1: *scatterplot with tip*

In the case of a simple encoding (say, position and color), these values are taken directly from the mark’s data. When a transform option (such as bin, group, etc.) is applied, the transformed channels (aggregate count, sum, top-5 modalities, etc.) are displayed instead.

example 2: *bar chart with tip*

More generally, interaction mechanisms expect a user gesture—such as pointing with the mouse or tapping on the screen, on mobile—and highlight the relevant point, or display details. In Plot, this is obtained by combining two distinct primitives. First, the interaction primitive listens to the browser events generated by user gestures and decides which data point (or points) is the target of the gesture—the selection. Second, a mark renders that selection. This composability is what allows, for example, the presentation of a fixed tip mark (without pointing), or conversely the highlighting of the *x* and *y* values of the data point selected by the user with a [crosshair](./crosshair.md) instead of a tip.

Plot currently supports one built-in interaction primitive, the *pointer*, which selects the data point that is the closest to the location of the mouse—or, on mobile, the closest to the location of a tap gesture. Combining it with the *tip* mark creates the default “tooltip” that shows the data values of that point in a callout box.

example 3: *pointer + dot*

<!--
## Brush

## Lasso

## Keyboard

## Zoom

-->

## Pointer options

* **px**
* **py**
* **maxRadius**

If **px** is not specified, falls back to **x1**, **x2**, or **x**. If **py** is not specified, falls back to **y1**, **y2**, or **y**.

## pointer(*options*)

```js
Plot.pointer({x: "Date", y: "Close"})
```

Given a position along *x* and *y*, adds a pointer interaction to the given *options*, and returns the options. The interaction selects the closest point to the user gesture. It listens to the pointermove and pointerenter events on the plot’s svg element to detect the mouse or tap location. It then selects the data point *i* that is closest to that location, and rerenders the mark with the index [*i*]. If the distance in pixels from the pointer location to the selected data point is greater than **maxRadius**, the selection is empty. The interaction also listens to pointerdown events, and toggles the sticky behavior. When the behavior is sticky, pointermove events are ignored—allowing the user, for example, to select and copy the text in the tip mark. The pointerout events (when the mouse exists the region of the plot), also empty the selection, and rerender the mark.

## pointerX(*options*)

```js
Plot.pointerX({x: "Date", y: "Close"})
```

Given a position along *x* and *y*, adds an horizontal pointer interaction to the given *options*, and returns the options. This is similar to **pointer**, except that the distance is computed (mainly) along the *x* dimension—with a tiny contribution of the vertical distance along the *y* axis to disambiguate ties. Intended to work with any mark that privileges the horizontal dimension for pointing, such as a vertical bar chart, a temporal line chart where time is horizontal, etc.

## pointerY(*options*)

```js
Plot.pointerY({x: "frequency", y: "letter"})
```

Given a position along *x* and *y*, adds a vertical pointer interaction to the given *options*, and returns the options. This is similar to **pointer**, except that the distance is computed (mainly) along the *y* dimension—with a tiny contribution of the horizontal distance along the *x* axis to disambiguate ties. Intended to work with any mark that privileges the vertical dimension for pointing, such as a horizontal bar chart.
