<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="https://cdn.jsdelivr.net/npm/d3@6"></script>
<script src="../dist/@observablehq/plot.umd.js"></script>
<script>

d3.json("data/movies.json").then(movies => {
  const Genre = d => d["Major Genre"] || "Other";
  const Profit = d => (d["Worldwide Gross"] - d["Production Budget"]) / 1e6;
  const genres = d3.group(movies, Genre);
  document.body.appendChild(Plot.plot({
    marginLeft: 120,
    x: {
      grid: true,
      inset: 6,
      label: "Profit ($M) â†’",
      domain: [d3.min(movies, Profit), 1e3]
    },
    y: {
      domain: d3.rollups(movies, movies => d3.median(movies, Profit), Genre)
        .sort(([, a], [, b]) => d3.descending(a, b))
        .map(([key]) => key)
    },
    marks: [
      /*
      Plot.ruleX([0]),
      Plot.barX(genres, {
        y: ([genre]) => genre,
        x1: ([, movies]) => d3.quantile(movies, 0.25, Profit),
        x2: ([, movies]) => d3.quantile(movies, 0.75, Profit),
        fillOpacity: 0.2
      }),
      */
      Plot.symbol(movies, {
        y: Genre,
        x: Profit,
        fill: () => Math.random()*2 | 0,
        symbol: () => ["dot", "rect"][Math.random()*2|0],
        size: () => (Math.random()**2.5),
        opacity: 0.3
      }),
      /*
      Plot.tickX(genres, {
        y: ([genre]) => genre,
        x: ([, movies]) => d3.median(movies, Profit),
        stroke: "red",
        strokeWidth: 2
      })
      */
    ]
  }));
});

</script>
